<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¡œê·¸ì¸ í˜ì´ì§€</title>

    <!-- <script src="./src/assets/js/color-thief.min.js"></script>
    <script src="./src/assets/js/getEventListeners.min.js"></script>
    <script src="./src/assets/js/html2canvas.min.js"></script> -->
  </head>
  <body>
    <div class="head-title">
      <div class="title">
        <img src="./src/assets/img/icon.png" alt="" />
      </div>
      <span>ì˜¨ë¼ì¸ ê°•ì˜ ë‚´ ë™ì êµ¬ì„± ì˜ˆì œ</span>
    </div>
    <div class="container" data-nx-layer-container>
      <div class="left">
        <video id="video" src="./src/assets/video/login.mp4" controls></video>
      </div>
      <div class="right">
        <div class="list-box" data-nx-panel data-index="1">
          <div class="list-title">ê°•ì˜ ìˆœì„œ</div>
          <ul>
            <li>1. ê°œìš”</li>
            <li>2. êµ¬ì„±ë„ ì„¤ëª…</li>
            <li>3. ì£¼ìš” ê¸°ëŠ¥</li>
            <li>4. ê¸°ëŒ€ íš¨ê³¼</li>
          </ul>
        </div>
        <div class="button-options" data-nx-panel data-index="2">
          <div class="text">ë‹¤ìŒ ë‹¤ì¹˜ ì„ íƒ ë²„íŠ¼ ë™ì êµ¬ì„± ì„¤ì •</div>
          <div class="text">â‰ ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ ë³€ê²½ ê°€ëŠ¥</div>
          <div class="button-option">
            <span>ê¸°ë³¸ ë°°ê²½ìƒ‰</span>
            <input type="text" name="" id="background" value="#000000" />
          </div>
          <!-- <div class="button-option">
            <span>ì´ë²¤íŠ¸ ë°°ê²½ìƒ‰</span>
            <input type="text" name="" id="hover" value="#fac001" />
          </div> -->
          <div class="button-option">
            <span>ê¸°ë³¸ í°íŠ¸ìƒ‰</span>
            <input type="text" name="" id="font" value="#ffffff" />
          </div>
          <label for="flip" class="button-option cursor">
            <input type="checkbox" name="" id="flip" checked />
            <span>í…ìŠ¤íŠ¸ í”Œë¦½ ê¸°ëŠ¥</span>
          </label>
        </div>
        <div class="btn-container" data-nx-panel data-index="3">
          <button data-nx-next-button-1>ë‹¤ìŒ ì°¨ì‹œ ì§„í–‰</button>
          <button>ì¢…ë£Œ</button>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="text-btn-container">
        <button onclick="resetPage();">ì›ë³¸ êµ¬ì„±</button>
        <button onclick="openModalBefore();">ì§‘ì¤‘ë„ í™•ì¸ íŒì—… ë™ì êµ¬ì„±</button>
        <button onclick="generateNextButton();">ë‹¤ìŒ ì°¨ì‹œ ì„ íƒ ë²„íŠ¼ ë™ì êµ¬ì„±</button>
        <button onclick="layoutShuffle();">ë ˆì´ì•„ì›ƒ ë™ì  êµ¬ì„±</button>
        <button onclick="randomExec();">ì „ì²´ ëœë¤ êµ¬ì„±</button>
      </div>
    </div>
    <div id="modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-body">
          <span class="modal-title">ì§‘ì¤‘ë„ í™•ì¸</span>
          <span class="modal-text"
            >í˜„ì¬ ê°•ì˜ë¥¼ ì‹œì²­ ì¤‘ì´ì‹ ê°€ìš”?<br />10ì´ˆ ë‚´ ì‘ë‹µí•˜ì§€ ì•Šìœ¼ë©´ 'ë¯¸ì§‘ì¤‘'ì²˜ë¦¬</span
          >
          <div class="buttons">
            <button class="blue-btn" onclick="closeModal('start');">ì˜ˆ, ì‹œì²­ ì¤‘ì…ë‹ˆë‹¤</button>
            <button>ì•„ë‹ˆìš”</button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    window.onload = function () {
      sessionStorage.removeItem("auto-refresh");
    };
  </script>

  <style>
    body {
      width: 100vw;
      height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
    }

    .head-title {
      width: 100%;
      height: 40px;
      border-bottom: 1px solid #ccc;
      text-align: center;
      padding: 5px;
      font-size: 16px;
      line-height: 30px;
      font-weight: bold;
    }

    .head-title .title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      flex: 1 1 auto;
      text-align: center;
      position: absolute;
      left: 10px;
    }

    .head-title .title img {
      max-height: 30px;
      width: auto;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    * {
      box-sizing: border-box;
    }

    .container {
      position: relative;
      width: 100%;
      height: calc(100% - 140px);
      display: flex;
      flex: 1 1 auto;
    }

    .container .left {
      flex: 1 1 auto;
    }

    .container .right {
      width: 300px;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }

    .container .right .list-box {
      flex: 100 1 auto;
    }

    .container .right .list-box .list-title{
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      padding: 0 10px;
    }

    .container .right .list-box ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .container .right .list-box ul li {
      list-style: none;
      padding: 10px;
      /* border: 1px solid #ccc; */
      cursor: pointer;
    }

    .container .right .list-box ul li:hover {
      /* border: 1px solid #007bff; */
      background-color: #007bff;
      color: white;
    }

    .container .right .button-options {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      font-size: 12px;
    }

    .container .right .button-options .text {
      font-size: 12px;
      margin-bottom: 10px;
    }

    .container .right .button-options .button-option {
      margin-bottom: 10px;
    }

    .container .right .button-options .button-option span {
      min-width: 150px;
      display: inline-block;
    }

    .container .right .button-options .button-option.cursor {
      cursor: pointer;
    }

    .container .right .btn-container {
      flex: 1 1 auto;
      display: none;
      flex-direction: column;
      align-items: flex-end;
    }

    .container .right .btn-container button {
      width: 100%;
      padding: 0;
      height: 36px;
      line-height: 36px;
      margin-top: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    .panel {
      width: 100%;
      height: 100px;
      border-top: 1px solid #ccc;
      display: flex;
      padding: 20px;
    }

    .panel .text-btn-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      gap: 10px;
    }

    .panel .text-btn-container button {
      width: auto;
      padding: 10px 20px;
    }

    .panel button {
      min-width: 80px;
      border: 0;
      cursor: pointer;
      background-color: #595959;
      color: #fff;
      border-radius: 5px;
      transition: all 0.3s;
      padding: 5px 10px;
      margin-right: 5px;
      display: block;
      width: 100%;
      margin-bottom: 0.5rem;
    }

    .panel button:hover {
      background-color: #fac001;
    }

    .panel .logs {
      width: calc(100% - 200px);
      padding: 20px;
      border-left: 1px solid #aaa;
      height: 100%;
      overflow: auto;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª…í•œ ê²€ì • ë°°ê²½ */
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999; /* ë‹¤ë¥¸ ìš”ì†Œë³´ë‹¤ ìœ„ì— í‘œì‹œ */
    }

    /* íŒì—… ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .modal-content {
      background-color: #fff;
      padding: 16px 32px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      animation: fadeIn 0.3s ease;
    }

    .modal-body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .modal-body .modal-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .modal-body .modal-text {
      font-size: 16px;
      margin: 5px 0 10px;
      text-align: center;
    }

    .modal-body .buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      margin-top: 10px;
    }

    .modal-body button {
      font-size: 14px;
      padding: 5px 10px;
      border: 0;
      border-radius: 5px;
      cursor: pointer;
    }

    .modal-body .blue-btn {
      background-color: #007bff;
      color: white;
    }

    /* ê°„ë‹¨í•œ fade-in ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>

  <script>
    let BUTTON_FLAG = false;
    let VIDEO_FLAG = false;
    let ORG_FLAG = true;

    document.addEventListener("DOMContentLoaded", function () {
      const video = document.getElementById("video");
      let videoStart = false; // ì‹œì‘ ì´ë²¤íŠ¸ ì¤‘ë³µ ë°©ì§€ìš©
      let hasReachedHalf = false; // 50% ì´ë²¤íŠ¸ ì¤‘ë³µ ë°©ì§€ìš©

      // 1. ì¬ìƒ ì‹œì‘
      // video.addEventListener("play", () => {
      //   if (!videoStart && video.currentTime === 0) {
      //     video.pause();
      //     openModal("ğŸ¬ ì˜ìƒì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
      //     videoStart = true;
      //   }
      // });

      // 2. ì˜ìƒ ì§„í–‰ 50% ë„ë‹¬ ì‹œ
      video.addEventListener("timeupdate", () => {
        if (!hasReachedHalf && video.currentTime >= video.duration / 2) {
          hasReachedHalf = true;
          video.pause();
          openModal("ì˜ìƒì´ 50% ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
      });

      // 3. ì˜ìƒ ì¢…ë£Œ
      video.addEventListener("ended", () => {
        hasReachedHalf = false;
        VIDEO_FLAG = true;
        video.pause();
        // openModal("ğŸ ì˜ìƒì´ ëë‚¬ìŠµë‹ˆë‹¤.");
        document.querySelector(".btn-container").style.display = "flex";
      });
    });

    function layoutShuffle() {
      //   appendLog("ë ˆì´ì•„ì›ƒ ë³€ê²½");

      const layerContainer = document.querySelector("[data-nx-layer-container]");
      const layerList = document.querySelectorAll("[data-nx-layer]");
      // layerContainer.style.display = "flex";
      // layerContainer.style.flexWrap = "wrap";
      // layerList.forEach((layer) => {
      //   layer.style.float = "unset";
      // });

      // for (let i = layerList.length - 1; i > 0; i--) {
      if (Math.floor(Math.random() * 100) % 2 == 1) {
        // layerList[i].after(layerList[i - 1]);
        // layerList[0].style.float = "right";
        // layerList[1].style.float = "left";
        layerContainer.style.flexDirection = "row";
      } else {
        layerContainer.style.flexDirection = "row-reverse";
      }
      // }

      const panelList = document.querySelectorAll("[data-nx-panel]");
      const random = Math.floor(Math.random() * 100) % 2;

      panelList[panelList.length - 1].insertAdjacentElement("afterend", panelList[random]);
    }

    function resetNextBtn() {
      document.querySelector(
        ".btn-container"
      ).innerHTML = `<button data-nx-next-button-1>ë‹¤ìŒ ì°¨ì‹œ ì§„í–‰</button>
          <button>ì¢…ë£Œ</button>`;
    }

    function generateNextButton() {
      if (BUTTON_FLAG) resetNextBtn();
      BUTTON_FLAG = true;

      //   appendLog("ë²„íŠ¼ ì†ì„± ë³€ê²½");
      const nxLastBtn = document.querySelector("[data-nx-next-button-1]");

      const NEXT_BTN_COLOR = document.querySelector("#background").value;
      // const NEXT_BTN_HOVER_COLOR = document.querySelector("#hover").value;
      const NEXT_BTN_FONT_COLOR = document.querySelector("#font").value;

      if (nxLastBtn) {
        let nxNewBtn = document.createElement("div");
        // text flip ì˜µì…˜ì´ ì¼œì§„ ê²½ìš°ì—ë§Œ í…ìŠ¤íŠ¸ random flip
        nxNewBtn.innerHTML = document.querySelector("#flip").checked
          ? flipAndTextToHtml(nxLastBtn.innerText)
          : nxLastBtn.innerText;
        copyAttributes(nxLastBtn, nxNewBtn);
        copyStyles(nxLastBtn, nxNewBtn);
        nxLastBtn.parentNode.insertBefore(nxNewBtn, nxLastBtn.nextSibling);
        nxLastBtn.setAttribute("style", "display:none");

        // nxNewBtn.addEventListener("mouseenter", function () {
        //   nxNewBtn.style.backgroundColor = NEXT_BTN_HOVER_COLOR;
        // });
        nxNewBtn.addEventListener("mouseleave", function () {
          nxNewBtn.style.backgroundColor = NEXT_BTN_COLOR;
        });

        const originalHREF = checkAndGetAttribute(nxLastBtn, "href");
        if (originalHREF) nxNewBtn.setAttribute("onclick", originalHREF);

        const originalOnclick = checkAndGetAttribute(nxLastBtn, "onclick");
        if (originalOnclick) nxNewBtn.setAttribute("onclick", originalOnclick);

        setTimeout(() => {
          copyEvent(nxLastBtn, nxNewBtn);
          nxLastBtn.remove();

          html2canvas(nxNewBtn, { scale: 1 }).then(function (canvas) {
            let imgBtn = document.createElement("img");
            imgBtn.setAttribute("src", canvas.toDataURL("image/jpeg"));
            imgBtn.setAttribute("style", "cursor: pointer;");
            copyStyles(nxNewBtn, imgBtn);
            nxNewBtn.parentNode.insertBefore(imgBtn, nxNewBtn.nextSibling);

            imgBtn.addEventListener("click", (event) => {
              nxNewBtn.click();
            });
            nxNewBtn.remove();
          });
        }, 10);
      }

      function checkAndGetAttribute(element, attribute) {
        if (element.hasAttribute(attribute)) {
          return element.getAttribute(attribute);
        } else {
          return null;
        }
      }

      function copyEvent(sourceElement, targetElement) {
        const originalEvent = sourceElement.getEventListeners();

        if (Object.keys(originalEvent).length) {
          for (const eventType in sourceElement.getEventListeners()) {
            if (
              Object.prototype.hasOwnProperty.call(sourceElement.getEventListeners(), eventType)
            ) {
              const events = sourceElement.getEventListeners()[eventType];
              for (const event of events) {
                targetElement.addEventListener(event.type, event.listener);
              }
            }
          }
        }
      }

      function copyAttributes(sourceElement, targetElement) {
        // Copy all attributes
        for (let attr of sourceElement.attributes) {
          if (attr.name != "data-nx-next-button-1")
            targetElement.setAttribute(attr.name, attr.value);
        }
      }

      function copyStyles(sourceElement, targetElement) {
        // Copy all computed styles
        const computedStyles = window.getComputedStyle(sourceElement);
        for (let style of computedStyles) {
          if (style == "background-color") {
            targetElement.style[style] = NEXT_BTN_COLOR;
          } else if (style == "color") {
            targetElement.style[style] = NEXT_BTN_FONT_COLOR;
          } else if (style.indexOf("-webkit-") != -1) {
            console.log("ì†ì„± ë¬´ì‹œ");
          } else {
            targetElement.style[style] = computedStyles.getPropertyValue(style);
          }
        }
      }

      function flipAndTextToHtml(orgText) {
        const textSplit = orgText.split("");

        for (let index = 0; index < textSplit.length; index++) {
          if (textSplit[index] != " ") {
            const random = Math.floor(Math.random() * 2);
            if (random === 0)
              textSplit[
                index
              ] = `<span style="display: inline-block; line-height: 1; transform: scaleX(-1);">${textSplit[index]}</span>`;
            else if (random === 1)
              textSplit[
                index
              ] = `<span style="display: inline-block; line-height: 1; transform: scaleX(1);">${textSplit[index]}</span>`;
          }
        }

        return textSplit.join("");
      }
    }

    function openModalBefore() {
      ORG_FLAG = false;
      openModal("ì§‘ì¤‘ë„ í™•ì¸ íŒì—… ë™ì êµ¬ì„±");
      // if (ORG_FLAG) {
      //   ORG_FLAG = false;
      // } else {
      //   closeModal("stop");
      // }
    }

    function openModal(text) {
      document.getElementById("modal").style.display = "flex";

      const modal = document.getElementById("modal");
      modal.style.display = "flex";

      // ëœë¤ ìœ„ì¹˜ ê³„ì‚°
      const modalContent = modal.querySelector(".modal-content");
      const modalWidth = modalContent.offsetWidth;
      const modalHeight = modalContent.offsetHeight;

      const maxLeft = window.innerWidth - modalWidth;
      const maxTop = window.innerHeight - modalHeight;

      const randomLeft = Math.max(0, Math.floor(Math.random() * maxLeft));
      const randomTop = Math.max(0, Math.floor(Math.random() * maxTop));

      if (ORG_FLAG) {
        modalContent.style.position = "unset";
        modalContent.style.left = `unset`;
        modalContent.style.top = `unset`;
      } else {
        modalContent.style.position = "absolute";
        modalContent.style.left = `${randomLeft}px`;
        modalContent.style.top = `${randomTop}px`;
        shuffleModalButtons();
      }
    }

    function shuffleModalButtons() {
      const buttons = document.querySelectorAll(".modal-body .buttons button");
      const shuffledButtons = Array.from(buttons).sort(() => Math.random() - 0.5);

      const buttonsContainer = document.querySelector(".modal-body .buttons");
      buttonsContainer.innerHTML = ""; // ê¸°ì¡´ ë²„íŠ¼ ì œê±°

      shuffledButtons.forEach((button) => {
        buttonsContainer.appendChild(button); // ì…”í”Œëœ ë²„íŠ¼ ì¶”ê°€
      });
    }

    function closeModal(type) {
      const video = document.getElementById("video");
      document.getElementById("modal").style.display = "none";
      if (!VIDEO_FLAG && type !== "stop") video.play();
    }

    function resetPage() {
      ORG_FLAG = true;

      document.querySelector(".btn-container").style.display = "none";
      resetNextBtn();
      resetPanel();

      const video = document.getElementById("video");
      video.play();
    }

    function resetPanel() {
      const panelList = Array.from(document.querySelectorAll("[data-nx-panel]"));

      // data-index ì†ì„±ì„ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
      const sortedPanels = panelList.sort((a, b) => {
        const indexA = parseInt(a.getAttribute("data-index"), 10);
        const indexB = parseInt(b.getAttribute("data-index"), 10);
        return indexA - indexB;
      });

      // ê¸°ì¤€ì´ ë  ë¶€ëª¨ ë…¸ë“œ
      const parent = panelList[0].parentNode;

      // ê¸°ì¡´ ìš”ì†Œë“¤ì„ ì •ë ¬ëœ ìˆœì„œë¡œ ë‹¤ì‹œ ì‚½ì…
      sortedPanels.forEach((panel) => {
        parent.appendChild(panel); // appendChildëŠ” ê¸°ì¡´ ìœ„ì¹˜ì—ì„œ ì´ë™ì‹œí‚´ (ë³µì‚¬ ì•„ë‹˜)
      });
    }

    function randomExec() {
      ORG_FLAG = false;
      layoutShuffle();
      generateNextButton();
      openModal();
    }
  </script>
</html>
